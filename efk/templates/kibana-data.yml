apiVersion: v1
kind: ConfigMap
metadata:
  name: kibana-data
data:
  curl-script.sh: |
    #!/bin/sh

    # Wait for Kibana to be available & healthy
    function wait_for_kibana {
        echo ">>>>>>>>>>>>>>>> Testing connection to Kibana... <<<<<<<<<<<<<<<<"
        until curl -fsSLI -o /dev/null http://${KIBANA_HOST}:${KIBANA_PORT}/api/status; do
          echo ">>>>>>>>>> Kibana not ready, waiting... <<<<<<<<<<<<<"
          sleep 5
        done
        echo ">>>>>>>>>>>>>>>> Kibana up and running... <<<<<<<<<<<<<<<<"
    }

    # Import objects
    function import_objects {
        echo ">>>>>>>>>>>>>>>> Importing objects... <<<<<<<<<<<<<<<<"

        OUTPUT=$(curl -X POST http://${KIBANA_HOST}:${KIBANA_PORT}/api/saved_objects/_import -H "Content-Type: multipart/form-data" -H "kbn-xsrf: true" -F "file=@/kibana/file.ndjson")
        SUCCESS=$(echo ${OUTPUT} | grep -o '"success":true' | wc -l)
        
        if [[ ${SUCCESS} == "1" ]]; then
          printf "\n>>>>>>>>>>>>>> Imported objects successfully! <<<<<<<<<<<<<<<<<<<<<<<\n"
        else
          printf "\n>>>>>>>>>>>>>> Failure while importing objects! <<<<<<<<<<<<<<<<<<<<<\n"
          exit 1
        fi

        echo "${OUTPUT}"
    }

    echo ">>>>>>>>>>>>>>>> Running ${0}... <<<<<<<<<<<<<<<<"
    wait_for_kibana
    import_objects

  file.ndjson: |
    {"attributes":{"fieldAttrs":"{}","fieldFormatMap":"{}","fields":"[]","name":"Task-it Logs","runtimeFieldMap":"{}","sourceFilters":"[]","timeFieldName":"@timestamp","title":"logstash-*","typeMeta":"{}"},"coreMigrationVersion":"8.8.0","created_at":"2024-01-18T12:58:32.824Z","id":"07263871-7305-40d2-a0ac-5c408b87e857","managed":false,"references":[],"type":"index-pattern","typeMigrationVersion":"8.0.0","updated_at":"2024-01-18T12:58:32.824Z","version":"WzUsMV0="}
    {"attributes":{"description":"","kibanaSavedObjectMeta":{"searchSourceJSON":"{\"query\":{\"query\":\"\",\"language\":\"kuery\"},\"filter\":[]}"},"optionsJSON":"{\"useMargins\":true,\"syncColors\":false,\"syncCursor\":true,\"syncTooltips\":false,\"hidePanelTitles\":false}","panelsJSON":"[{\"type\":\"visualization\",\"gridData\":{\"x\":0,\"y\":0,\"w\":48,\"h\":9,\"i\":\"52760aee-1b06-4bf1-bf1c-8205a16c43ed\"},\"panelIndex\":\"52760aee-1b06-4bf1-bf1c-8205a16c43ed\",\"embeddableConfig\":{\"savedVis\":{\"id\":\"\",\"title\":\"\",\"description\":\"\",\"type\":\"metrics\",\"params\":{\"time_range_mode\":\"entire_time_range\",\"id\":\"b44c47d1-8cbd-4606-8f91-f77c7ace6b03\",\"type\":\"timeseries\",\"series\":[{\"time_range_mode\":\"entire_time_range\",\"id\":\"607d910d-5d9d-400e-8b98-396d79996ace\",\"color\":\"#68BC00\",\"split_mode\":\"everything\",\"palette\":{\"type\":\"palette\",\"name\":\"default\"},\"metrics\":[{\"id\":\"88b8f1fd-2f7b-481e-97e3-e87ac1cffb2d\",\"type\":\"count\"}],\"separate_axis\":0,\"axis_position\":\"right\",\"formatter\":\"default\",\"chart_type\":\"line\",\"line_width\":1,\"point_size\":1,\"fill\":0.5,\"stacked\":\"none\",\"override_index_pattern\":0,\"series_drop_last_bucket\":0}],\"time_field\":\"\",\"use_kibana_indexes\":true,\"interval\":\"\",\"axis_position\":\"left\",\"axis_formatter\":\"number\",\"axis_scale\":\"normal\",\"show_legend\":1,\"truncate_legend\":1,\"max_lines_legend\":1,\"show_grid\":1,\"tooltip_mode\":\"show_all\",\"drop_last_bucket\":0,\"gauge_color_rules\":[{\"id\":\"48178a80-b608-11ee-a0a3-e3ff58fbbccd\"}],\"gauge_width\":10,\"gauge_inner_width\":10,\"gauge_style\":\"half\",\"isModelInvalid\":false,\"background_color_rules\":[{\"id\":\"53550b20-b608-11ee-a0a3-e3ff58fbbccd\"}],\"index_pattern_ref_name\":\"metrics_52760aee-1b06-4bf1-bf1c-8205a16c43ed_0_index_pattern\"},\"uiState\":{},\"data\":{\"aggs\":[],\"searchSource\":{\"query\":{\"query\":\"\",\"language\":\"kuery\"},\"filter\":[]}}},\"hidePanelTitles\":false,\"enhancements\":{}},\"title\":\"Logs Time-series\"},{\"type\":\"lens\",\"gridData\":{\"x\":0,\"y\":9,\"w\":24,\"h\":15,\"i\":\"35441b43-84b9-4045-bdfd-b11ffb4871f9\"},\"panelIndex\":\"35441b43-84b9-4045-bdfd-b11ffb4871f9\",\"embeddableConfig\":{\"attributes\":{\"title\":\"HTTP Methods\",\"description\":\"HTTP request methods and paths made to Task-it API.\",\"visualizationType\":\"lnsPie\",\"type\":\"lens\",\"references\":[{\"type\":\"index-pattern\",\"id\":\"07263871-7305-40d2-a0ac-5c408b87e857\",\"name\":\"indexpattern-datasource-layer-80ea4370-5526-4060-b919-632c9aead8d2\"},{\"type\":\"index-pattern\",\"name\":\"e3ee6a2b-8285-42e5-bf8b-f8f3da165e39\",\"id\":\"07263871-7305-40d2-a0ac-5c408b87e857\"}],\"state\":{\"visualization\":{\"shape\":\"pie\",\"layers\":[{\"layerId\":\"80ea4370-5526-4060-b919-632c9aead8d2\",\"primaryGroups\":[\"71eea36e-fac3-46b8-b3ed-26a19197d43d\",\"aea13f44-5957-45f8-887c-78313c11ee08\"],\"metrics\":[\"880544e0-b0c5-4b0a-b756-e261ffa79feb\"],\"numberDisplay\":\"percent\",\"categoryDisplay\":\"default\",\"legendDisplay\":\"default\",\"nestedLegend\":false,\"layerType\":\"data\"}]},\"query\":{\"query\":\"\",\"language\":\"kuery\"},\"filters\":[{\"meta\":{\"disabled\":false,\"negate\":false,\"alias\":null,\"index\":\"e3ee6a2b-8285-42e5-bf8b-f8f3da165e39\",\"key\":\"path\",\"field\":\"path\",\"params\":{\"query\":\"\\\"/^\\\\/api\\\\/tasks/\\\"\"},\"type\":\"phrase\"},\"query\":{\"match_phrase\":{\"path\":\"\\\"/^\\\\/api\\\\/tasks/\\\"\"}},\"$state\":{\"store\":\"appState\"}}],\"datasourceStates\":{\"formBased\":{\"layers\":{\"80ea4370-5526-4060-b919-632c9aead8d2\":{\"columns\":{\"aea13f44-5957-45f8-887c-78313c11ee08\":{\"label\":\"Top 4 values of method.keyword\",\"dataType\":\"string\",\"operationType\":\"terms\",\"scale\":\"ordinal\",\"sourceField\":\"method.keyword\",\"isBucketed\":true,\"params\":{\"size\":4,\"orderBy\":{\"type\":\"column\",\"columnId\":\"880544e0-b0c5-4b0a-b756-e261ffa79feb\"},\"orderDirection\":\"desc\",\"otherBucket\":true,\"missingBucket\":false,\"parentFormat\":{\"id\":\"terms\"},\"include\":[],\"exclude\":[],\"includeIsRegex\":false,\"excludeIsRegex\":false},\"customLabel\":true},\"71eea36e-fac3-46b8-b3ed-26a19197d43d\":{\"label\":\"Top 100 values of path.keyword\",\"dataType\":\"string\",\"operationType\":\"terms\",\"scale\":\"ordinal\",\"sourceField\":\"path.keyword\",\"isBucketed\":true,\"params\":{\"size\":100,\"orderBy\":{\"type\":\"column\",\"columnId\":\"880544e0-b0c5-4b0a-b756-e261ffa79feb\"},\"orderDirection\":\"desc\",\"otherBucket\":true,\"missingBucket\":false,\"parentFormat\":{\"id\":\"terms\"},\"include\":[],\"exclude\":[],\"includeIsRegex\":false,\"excludeIsRegex\":false}},\"880544e0-b0c5-4b0a-b756-e261ffa79feb\":{\"label\":\"Count of records\",\"dataType\":\"number\",\"operationType\":\"count\",\"isBucketed\":false,\"scale\":\"ratio\",\"sourceField\":\"___records___\",\"params\":{\"emptyAsNull\":true}}},\"columnOrder\":[\"aea13f44-5957-45f8-887c-78313c11ee08\",\"71eea36e-fac3-46b8-b3ed-26a19197d43d\",\"880544e0-b0c5-4b0a-b756-e261ffa79feb\"],\"incompleteColumns\":{},\"sampling\":1}}},\"indexpattern\":{\"layers\":{}},\"textBased\":{\"layers\":{}}},\"internalReferences\":[],\"adHocDataViews\":{}}},\"enhancements\":{}}},{\"type\":\"lens\",\"gridData\":{\"x\":24,\"y\":9,\"w\":24,\"h\":15,\"i\":\"59ae2e24-bcb8-44d5-9bae-3435ed1f044e\"},\"panelIndex\":\"59ae2e24-bcb8-44d5-9bae-3435ed1f044e\",\"embeddableConfig\":{\"attributes\":{\"title\":\"\",\"description\":\"\",\"visualizationType\":\"lnsXY\",\"type\":\"lens\",\"references\":[{\"type\":\"index-pattern\",\"id\":\"07263871-7305-40d2-a0ac-5c408b87e857\",\"name\":\"indexpattern-datasource-layer-319b6bb1-a98d-40e6-a6e7-4d7d739c497c\"}],\"state\":{\"visualization\":{\"legend\":{\"isVisible\":true,\"position\":\"right\"},\"valueLabels\":\"hide\",\"fittingFunction\":\"None\",\"axisTitlesVisibilitySettings\":{\"x\":true,\"yLeft\":true,\"yRight\":true},\"tickLabelsVisibilitySettings\":{\"x\":true,\"yLeft\":true,\"yRight\":true},\"labelsOrientation\":{\"x\":0,\"yLeft\":0,\"yRight\":0},\"gridlinesVisibilitySettings\":{\"x\":true,\"yLeft\":true,\"yRight\":true},\"preferredSeriesType\":\"bar_stacked\",\"layers\":[{\"layerId\":\"319b6bb1-a98d-40e6-a6e7-4d7d739c497c\",\"accessors\":[\"4326b76b-2c72-4fae-b8b4-c394f78ed98c\"],\"position\":\"top\",\"seriesType\":\"bar_stacked\",\"showGridlines\":false,\"layerType\":\"data\",\"yConfig\":[{\"forAccessor\":\"4326b76b-2c72-4fae-b8b4-c394f78ed98c\",\"axisMode\":\"left\"}],\"splitAccessor\":\"6e4f0930-31dc-48fc-9013-db7e9b333f81\",\"xAccessor\":\"949ca833-6d38-44b4-87ce-37ffa82d5596\"}]},\"query\":{\"query\":\"\",\"language\":\"kuery\"},\"filters\":[],\"datasourceStates\":{\"formBased\":{\"layers\":{\"319b6bb1-a98d-40e6-a6e7-4d7d739c497c\":{\"columns\":{\"4326b76b-2c72-4fae-b8b4-c394f78ed98c\":{\"label\":\"Log Messages Count\",\"dataType\":\"number\",\"operationType\":\"count\",\"isBucketed\":false,\"scale\":\"ratio\",\"sourceField\":\"___records___\",\"params\":{\"emptyAsNull\":true},\"customLabel\":true},\"6e4f0930-31dc-48fc-9013-db7e9b333f81\":{\"label\":\"Log Message\",\"dataType\":\"string\",\"operationType\":\"terms\",\"scale\":\"ordinal\",\"sourceField\":\"message.keyword\",\"isBucketed\":true,\"params\":{\"size\":100,\"orderBy\":{\"type\":\"column\",\"columnId\":\"4326b76b-2c72-4fae-b8b4-c394f78ed98c\"},\"orderDirection\":\"desc\",\"otherBucket\":true,\"missingBucket\":false,\"parentFormat\":{\"id\":\"terms\"},\"include\":[],\"exclude\":[],\"includeIsRegex\":false,\"excludeIsRegex\":false},\"customLabel\":true},\"949ca833-6d38-44b4-87ce-37ffa82d5596\":{\"label\":\"Log Severity\",\"dataType\":\"string\",\"operationType\":\"terms\",\"scale\":\"ordinal\",\"sourceField\":\"severity.keyword\",\"isBucketed\":true,\"params\":{\"size\":5,\"orderBy\":{\"type\":\"column\",\"columnId\":\"4326b76b-2c72-4fae-b8b4-c394f78ed98c\"},\"orderDirection\":\"desc\",\"otherBucket\":true,\"missingBucket\":false,\"parentFormat\":{\"id\":\"terms\"},\"include\":[],\"exclude\":[],\"includeIsRegex\":false,\"excludeIsRegex\":false},\"customLabel\":true}},\"columnOrder\":[\"949ca833-6d38-44b4-87ce-37ffa82d5596\",\"6e4f0930-31dc-48fc-9013-db7e9b333f81\",\"4326b76b-2c72-4fae-b8b4-c394f78ed98c\"],\"incompleteColumns\":{},\"sampling\":1}}},\"indexpattern\":{\"layers\":{}},\"textBased\":{\"layers\":{}}},\"internalReferences\":[],\"adHocDataViews\":{}}},\"hidePanelTitles\":false,\"enhancements\":{}},\"title\":\"Task-it Log Messages\"}]","timeRestore":false,"title":"Task-it","version":1},"coreMigrationVersion":"8.8.0","created_at":"2024-01-18T13:53:12.622Z","id":"db1be6a0-b603-11ee-8eca-f95aaae83657","managed":false,"references":[{"id":"07263871-7305-40d2-a0ac-5c408b87e857","name":"52760aee-1b06-4bf1-bf1c-8205a16c43ed:metrics_52760aee-1b06-4bf1-bf1c-8205a16c43ed_0_index_pattern","type":"index-pattern"},{"id":"07263871-7305-40d2-a0ac-5c408b87e857","name":"35441b43-84b9-4045-bdfd-b11ffb4871f9:indexpattern-datasource-layer-80ea4370-5526-4060-b919-632c9aead8d2","type":"index-pattern"},{"id":"07263871-7305-40d2-a0ac-5c408b87e857","name":"35441b43-84b9-4045-bdfd-b11ffb4871f9:e3ee6a2b-8285-42e5-bf8b-f8f3da165e39","type":"index-pattern"},{"id":"07263871-7305-40d2-a0ac-5c408b87e857","name":"59ae2e24-bcb8-44d5-9bae-3435ed1f044e:indexpattern-datasource-layer-319b6bb1-a98d-40e6-a6e7-4d7d739c497c","type":"index-pattern"}],"type":"dashboard","typeMigrationVersion":"8.9.0","updated_at":"2024-01-18T13:53:12.622Z","version":"WzEwMCwxXQ=="}
    {"excludedObjects":[],"excludedObjectsCount":0,"exportedCount":2,"missingRefCount":0,"missingReferences":[]}
